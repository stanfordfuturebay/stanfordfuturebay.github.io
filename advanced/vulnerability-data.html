<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.3 Vulnerability data | Shaping the Future of the Bay Area: Advanced Urban Data Analytics in R</title>
  <meta name="description" content="5.3 Vulnerability data | Shaping the Future of the Bay Area: Advanced Urban Data Analytics in R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="5.3 Vulnerability data | Shaping the Future of the Bay Area: Advanced Urban Data Analytics in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.3 Vulnerability data | Shaping the Future of the Bay Area: Advanced Urban Data Analytics in R" />
  
  
  

<meta name="author" content="Stanford Future Bay Initiative" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exposure-data.html"/>
<link rel="next" href="risk-estimation.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://bay.stanford.edu">Stanford Future Bay Initiative</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="land-use.html"><a href="land-use.html"><i class="fa fa-check"></i><b>2</b> Land Use</a>
<ul>
<li class="chapter" data-level="2.1" data-path="housing-costs.html"><a href="housing-costs.html"><i class="fa fa-check"></i><b>2.1</b> Housing costs</a></li>
<li class="chapter" data-level="2.2" data-path="parcel-data.html"><a href="parcel-data.html"><i class="fa fa-check"></i><b>2.2</b> Parcel data</a></li>
<li class="chapter" data-level="2.3" data-path="census-to-parcel-disaggregation.html"><a href="census-to-parcel-disaggregation.html"><i class="fa fa-check"></i><b>2.3</b> Census-to-parcel disaggregation</a></li>
<li class="chapter" data-level="2.4" data-path="parcel-and-building-geometries.html"><a href="parcel-and-building-geometries.html"><i class="fa fa-check"></i><b>2.4</b> Parcel and building geometries</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mobility.html"><a href="mobility.html"><i class="fa fa-check"></i><b>3</b> Mobility</a>
<ul>
<li class="chapter" data-level="3.1" data-path="travel-survey-data.html"><a href="travel-survey-data.html"><i class="fa fa-check"></i><b>3.1</b> Travel survey data</a></li>
<li class="chapter" data-level="3.2" data-path="commute-data.html"><a href="commute-data.html"><i class="fa fa-check"></i><b>3.2</b> Commute data</a></li>
<li class="chapter" data-level="3.3" data-path="routing.html"><a href="routing.html"><i class="fa fa-check"></i><b>3.3</b> Routing</a></li>
<li class="chapter" data-level="3.4" data-path="accessibility.html"><a href="accessibility.html"><i class="fa fa-check"></i><b>3.4</b> Accessibility</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sustainability.html"><a href="sustainability.html"><i class="fa fa-check"></i><b>4</b> Sustainability</a>
<ul>
<li class="chapter" data-level="4.1" data-path="vehicle-emissions.html"><a href="vehicle-emissions.html"><i class="fa fa-check"></i><b>4.1</b> Vehicle emissions</a></li>
<li class="chapter" data-level="4.2" data-path="building-emissions.html"><a href="building-emissions.html"><i class="fa fa-check"></i><b>4.2</b> Building emissions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hazards.html"><a href="hazards.html"><i class="fa fa-check"></i><b>5</b> Hazards</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hazard-data.html"><a href="hazard-data.html"><i class="fa fa-check"></i><b>5.1</b> Hazard data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="hazard-data.html"><a href="hazard-data.html#wildfires"><i class="fa fa-check"></i><b>5.1.1</b> Wildfires</a></li>
<li class="chapter" data-level="5.1.2" data-path="hazard-data.html"><a href="hazard-data.html#air-pollution"><i class="fa fa-check"></i><b>5.1.2</b> Air Pollution</a></li>
<li class="chapter" data-level="5.1.3" data-path="hazard-data.html"><a href="hazard-data.html#extreme-heat"><i class="fa fa-check"></i><b>5.1.3</b> Extreme Heat</a></li>
<li class="chapter" data-level="5.1.4" data-path="hazard-data.html"><a href="hazard-data.html#sea-level-rise"><i class="fa fa-check"></i><b>5.1.4</b> Sea Level Rise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="exposure-data.html"><a href="exposure-data.html"><i class="fa fa-check"></i><b>5.2</b> Exposure data</a></li>
<li class="chapter" data-level="5.3" data-path="vulnerability-data.html"><a href="vulnerability-data.html"><i class="fa fa-check"></i><b>5.3</b> Vulnerability data</a></li>
<li class="chapter" data-level="5.4" data-path="risk-estimation.html"><a href="risk-estimation.html"><i class="fa fa-check"></i><b>5.4</b> Risk estimation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Shaping the Future of the Bay Area: Advanced Urban Data Analytics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="vulnerability-data" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Vulnerability data</h2>
<p>The next step in the Stanford Urban Risk Framework does not involve collecting new geospatial data, but requires finding statistical models through literature review that attempt to answer the question: what is the relationship between the hazard intensity measure and damage to the exposed asset? For example, if the hazard intensity measure we’ve collected, in our case, is flood depth, and the exposed asset we’ve collected is building footprint, then the resultant vulnerability information we need is a way to convert flood depth to a percentage of loss value for a given building. We either will be able to find reasonable empirical information about this through research, or we won’t. In our case, we can find “depth-damage curves” produced by the U.S. Army Corps of Engineers through review of building damage in past flood events; this is in fact a key type of analysis that USACE and FEMA conduct to guide future engineering projects and policies/programs. In this page of “<a href="https://planning.erdc.dren.mil/toolbox/library.cfm?Option=Listing&amp;Type=EGM&amp;Search=Policy&amp;Sort=Default">Economic Guidance Memoranda</a>”, <a href="https://planning.erdc.dren.mil/toolbox/library/EGMs/egm01-03.pdf">EGM 01-03</a> provides tables of structure depth-damage and content depth-damage for different residential building types, such as “One Story, No Basement” in Table 1. Other reports from similar sources provide similar curves for nonresidential buildings, or for freshwater vs. saltwater, or for entirely other hazards and assets. For our demonstration, as a simplifying assumption (which you could improve upon in a more in-depth analysis), we’ll just assume that all buildings in our study area experience damage based on the relationship of structure depth-damage shown in Table 1, which we’ll now manually type up in R. The negative depths shown are relative to 0 being the “first floor elevation”, which is an empirical attribute we can’t easily collect at the building level, even from the Assessor-Recorder data if we had it, so as a simplifying assumption we’ll assume that every building is raised 2ft from the actual ground level for which we have flood depths. That means that flooding at a depth of -1 ft is floodwater that may damage building crawl spaces or structure below the first floor. We could also use the standard deviations provided to run a Monte Carlo simulation, as demonstrated before, to understand the standard deviation of our final results, given the nonlinearity of this depth-damage curve, and the multiple layers of analysis overall.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="vulnerability-data.html#cb200-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb200-2"><a href="vulnerability-data.html#cb200-2"></a><span class="kw">library</span>(plotly)</span></code></pre></div>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="vulnerability-data.html#cb201-1"></a>vulnerability &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb201-2"><a href="vulnerability-data.html#cb201-2"></a>  <span class="dt">depth =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span><span class="op">:</span><span class="dv">16</span>),</span>
<span id="cb201-3"><a href="vulnerability-data.html#cb201-3"></a>  <span class="dt">perc_damage =</span> <span class="kw">c</span>(</span>
<span id="cb201-4"><a href="vulnerability-data.html#cb201-4"></a>    <span class="dv">0</span>,</span>
<span id="cb201-5"><a href="vulnerability-data.html#cb201-5"></a>    <span class="fl">0.025</span>,</span>
<span id="cb201-6"><a href="vulnerability-data.html#cb201-6"></a>    <span class="fl">0.134</span>,</span>
<span id="cb201-7"><a href="vulnerability-data.html#cb201-7"></a>    <span class="fl">0.233</span>,</span>
<span id="cb201-8"><a href="vulnerability-data.html#cb201-8"></a>    <span class="fl">0.321</span>,</span>
<span id="cb201-9"><a href="vulnerability-data.html#cb201-9"></a>    <span class="fl">0.401</span>,</span>
<span id="cb201-10"><a href="vulnerability-data.html#cb201-10"></a>    <span class="fl">0.471</span>,</span>
<span id="cb201-11"><a href="vulnerability-data.html#cb201-11"></a>    <span class="fl">0.532</span>,</span>
<span id="cb201-12"><a href="vulnerability-data.html#cb201-12"></a>    <span class="fl">0.586</span>,</span>
<span id="cb201-13"><a href="vulnerability-data.html#cb201-13"></a>    <span class="fl">0.632</span>,</span>
<span id="cb201-14"><a href="vulnerability-data.html#cb201-14"></a>    <span class="fl">0.672</span>,</span>
<span id="cb201-15"><a href="vulnerability-data.html#cb201-15"></a>    <span class="fl">0.705</span>,</span>
<span id="cb201-16"><a href="vulnerability-data.html#cb201-16"></a>    <span class="fl">0.732</span>,</span>
<span id="cb201-17"><a href="vulnerability-data.html#cb201-17"></a>    <span class="fl">0.754</span>,</span>
<span id="cb201-18"><a href="vulnerability-data.html#cb201-18"></a>    <span class="fl">0.772</span>,</span>
<span id="cb201-19"><a href="vulnerability-data.html#cb201-19"></a>    <span class="fl">0.785</span>,</span>
<span id="cb201-20"><a href="vulnerability-data.html#cb201-20"></a>    <span class="fl">0.795</span>,</span>
<span id="cb201-21"><a href="vulnerability-data.html#cb201-21"></a>    <span class="fl">0.802</span>,</span>
<span id="cb201-22"><a href="vulnerability-data.html#cb201-22"></a>    <span class="fl">0.807</span></span>
<span id="cb201-23"><a href="vulnerability-data.html#cb201-23"></a>  )</span>
<span id="cb201-24"><a href="vulnerability-data.html#cb201-24"></a>)</span></code></pre></div>
<p>Our next step of analysis is straightforwardly to “look-up” percent damages for every individual building, based on its recorded estimate of depth, for each of our 15 scenarios. In effect, because of the nonlinearity of this depth-damage curve, for each building, after subtracting 2 from its depth, we will need to identify where its flood depth falls between two rows of <code>vulnerability</code>, then use the adjacent table information to perform linear interpolation. We could use <code>lm()</code>, as we’ve used before, to achieve this, but <code>approx()</code> can handle the job more easily:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="vulnerability-data.html#cb202-1"></a>epa_bldg_exposure &lt;-<span class="st"> </span></span>
<span id="cb202-2"><a href="vulnerability-data.html#cb202-2"></a><span class="st">  </span><span class="kw">readRDS</span>(<span class="st">&quot;epa_bldg_exposure.rds&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-3"><a href="vulnerability-data.html#cb202-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb202-4"><a href="vulnerability-data.html#cb202-4"></a>    <span class="dt">avg_depth =</span> avg_depth<span class="op">*</span><span class="fl">0.0328084</span> <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="co"># cm to ft, subtract first floor elevation</span></span>
<span id="cb202-5"><a href="vulnerability-data.html#cb202-5"></a>  )</span>
<span id="cb202-6"><a href="vulnerability-data.html#cb202-6"></a></span>
<span id="cb202-7"><a href="vulnerability-data.html#cb202-7"></a>epa_bldg_perc_damage &lt;-<span class="st"> </span></span>
<span id="cb202-8"><a href="vulnerability-data.html#cb202-8"></a><span class="st">  </span><span class="kw">approx</span>(</span>
<span id="cb202-9"><a href="vulnerability-data.html#cb202-9"></a>    <span class="dt">x =</span> vulnerability<span class="op">$</span>depth,</span>
<span id="cb202-10"><a href="vulnerability-data.html#cb202-10"></a>    <span class="dt">y =</span> vulnerability<span class="op">$</span>perc_damage,</span>
<span id="cb202-11"><a href="vulnerability-data.html#cb202-11"></a>    <span class="dt">xout =</span> epa_bldg_exposure<span class="op">$</span>avg_depth</span>
<span id="cb202-12"><a href="vulnerability-data.html#cb202-12"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-13"><a href="vulnerability-data.html#cb202-13"></a><span class="st">  </span>.[<span class="dv">2</span>] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-14"><a href="vulnerability-data.html#cb202-14"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-15"><a href="vulnerability-data.html#cb202-15"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">perc_damage =</span> y) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-16"><a href="vulnerability-data.html#cb202-16"></a><span class="st">  </span><span class="kw">cbind</span>(epa_bldg_exposure)</span>
<span id="cb202-17"><a href="vulnerability-data.html#cb202-17"></a></span>
<span id="cb202-18"><a href="vulnerability-data.html#cb202-18"></a><span class="kw">saveRDS</span>(epa_bldg_perc_damage,<span class="st">&quot;epa_bldg_perc_damage.rds&quot;</span>)</span></code></pre></div>
<p>To demonstrate what is “happening” to buildings in an interactive plot, let’s first create a version of the tidy dataframe that includes every building for every scenario, where we fill in an average depth of -2 and a percent damage of 0 wherever we didn’t already have hazard/exposure data. <code>expand.grid()</code> helps us create a dataframe that has every combination of OpenStreetMap ID, sea level rise, and return period, which we then join our exposure data to, leaving NAs under <code>SLR</code> and <code>RP</code> for all empty records. We then promptly fill those NAs in with our placeholder data. This will help the data properly animate from “scene” to “scene”.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="vulnerability-data.html#cb203-1"></a>epa_bldg_perc_damage_plot &lt;-<span class="st"> </span></span>
<span id="cb203-2"><a href="vulnerability-data.html#cb203-2"></a><span class="st">  </span><span class="kw">expand.grid</span>(</span>
<span id="cb203-3"><a href="vulnerability-data.html#cb203-3"></a>    <span class="dt">osm_id =</span> <span class="kw">unique</span>(epa_bldg_perc_damage<span class="op">$</span>osm_id),</span>
<span id="cb203-4"><a href="vulnerability-data.html#cb203-4"></a>    <span class="dt">SLR =</span> <span class="kw">unique</span>(epa_bldg_perc_damage<span class="op">$</span>SLR),</span>
<span id="cb203-5"><a href="vulnerability-data.html#cb203-5"></a>    <span class="dt">RP =</span> <span class="kw">unique</span>(epa_bldg_perc_damage<span class="op">$</span>RP)</span>
<span id="cb203-6"><a href="vulnerability-data.html#cb203-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb203-7"><a href="vulnerability-data.html#cb203-7"></a><span class="st">  </span><span class="kw">left_join</span>(epa_bldg_perc_damage) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb203-8"><a href="vulnerability-data.html#cb203-8"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb203-9"><a href="vulnerability-data.html#cb203-9"></a>    <span class="dt">avg_depth =</span> <span class="kw">ifelse</span>(</span>
<span id="cb203-10"><a href="vulnerability-data.html#cb203-10"></a>      <span class="kw">is.na</span>(avg_depth),</span>
<span id="cb203-11"><a href="vulnerability-data.html#cb203-11"></a>      <span class="dv">-2</span>,</span>
<span id="cb203-12"><a href="vulnerability-data.html#cb203-12"></a>      avg_depth</span>
<span id="cb203-13"><a href="vulnerability-data.html#cb203-13"></a>    ),</span>
<span id="cb203-14"><a href="vulnerability-data.html#cb203-14"></a>    <span class="dt">perc_damage =</span> <span class="kw">ifelse</span>(</span>
<span id="cb203-15"><a href="vulnerability-data.html#cb203-15"></a>      <span class="kw">is.na</span>(perc_damage),</span>
<span id="cb203-16"><a href="vulnerability-data.html#cb203-16"></a>      <span class="dv">0</span>,</span>
<span id="cb203-17"><a href="vulnerability-data.html#cb203-17"></a>      perc_damage</span>
<span id="cb203-18"><a href="vulnerability-data.html#cb203-18"></a>    )</span>
<span id="cb203-19"><a href="vulnerability-data.html#cb203-19"></a>  )</span></code></pre></div>
<p>Here’s the animation created through <code>plotly</code>, demonstrating what kind of interactivity is possible when advancing from <code>ggplot</code> to a web-based package.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="vulnerability-data.html#cb204-1"></a>epa_plot &lt;-<span class="st"> </span></span>
<span id="cb204-2"><a href="vulnerability-data.html#cb204-2"></a><span class="st">  </span><span class="kw">plot_ly</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb204-3"><a href="vulnerability-data.html#cb204-3"></a><span class="st">  </span><span class="kw">add_trace</span>(</span>
<span id="cb204-4"><a href="vulnerability-data.html#cb204-4"></a>    <span class="dt">data =</span> </span>
<span id="cb204-5"><a href="vulnerability-data.html#cb204-5"></a>      epa_bldg_perc_damage_plot <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb204-6"><a href="vulnerability-data.html#cb204-6"></a><span class="st">        </span><span class="kw">filter</span>(RP <span class="op">==</span><span class="st"> &quot;100&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb204-7"><a href="vulnerability-data.html#cb204-7"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">SLR =</span> SLR <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()),</span>
<span id="cb204-8"><a href="vulnerability-data.html#cb204-8"></a>    <span class="dt">x =</span> <span class="op">~</span>avg_depth,</span>
<span id="cb204-9"><a href="vulnerability-data.html#cb204-9"></a>    <span class="dt">y =</span> <span class="op">~</span>perc_damage,</span>
<span id="cb204-10"><a href="vulnerability-data.html#cb204-10"></a>    <span class="dt">frame =</span> <span class="op">~</span>SLR,</span>
<span id="cb204-11"><a href="vulnerability-data.html#cb204-11"></a>    <span class="dt">type =</span> <span class="st">&#39;scatter&#39;</span>,</span>
<span id="cb204-12"><a href="vulnerability-data.html#cb204-12"></a>    <span class="dt">mode =</span> <span class="st">&#39;markers&#39;</span>,</span>
<span id="cb204-13"><a href="vulnerability-data.html#cb204-13"></a>    <span class="dt">marker =</span> <span class="kw">list</span>(</span>
<span id="cb204-14"><a href="vulnerability-data.html#cb204-14"></a>      <span class="dt">color =</span> <span class="st">&#39;rgba(17, 157, 255, 0.01)&#39;</span>,</span>
<span id="cb204-15"><a href="vulnerability-data.html#cb204-15"></a>      <span class="dt">size =</span> <span class="dv">15</span></span>
<span id="cb204-16"><a href="vulnerability-data.html#cb204-16"></a>    ),</span>
<span id="cb204-17"><a href="vulnerability-data.html#cb204-17"></a>    <span class="dt">showlegend =</span> F</span>
<span id="cb204-18"><a href="vulnerability-data.html#cb204-18"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb204-19"><a href="vulnerability-data.html#cb204-19"></a><span class="st">  </span><span class="kw">add_trace</span>(</span>
<span id="cb204-20"><a href="vulnerability-data.html#cb204-20"></a>    <span class="dt">data =</span> vulnerability,</span>
<span id="cb204-21"><a href="vulnerability-data.html#cb204-21"></a>    <span class="dt">x =</span> <span class="op">~</span>depth,</span>
<span id="cb204-22"><a href="vulnerability-data.html#cb204-22"></a>    <span class="dt">y =</span> <span class="op">~</span>perc_damage,</span>
<span id="cb204-23"><a href="vulnerability-data.html#cb204-23"></a>    <span class="dt">type =</span> <span class="st">&#39;scatter&#39;</span>,</span>
<span id="cb204-24"><a href="vulnerability-data.html#cb204-24"></a>    <span class="dt">mode =</span> <span class="st">&#39;markers&#39;</span>,</span>
<span id="cb204-25"><a href="vulnerability-data.html#cb204-25"></a>    <span class="dt">marker =</span> <span class="kw">list</span>(</span>
<span id="cb204-26"><a href="vulnerability-data.html#cb204-26"></a>      <span class="dt">color =</span> <span class="st">&#39;rgb(0,0,0)&#39;</span></span>
<span id="cb204-27"><a href="vulnerability-data.html#cb204-27"></a>    ),</span>
<span id="cb204-28"><a href="vulnerability-data.html#cb204-28"></a>    <span class="dt">showlegend =</span> F</span>
<span id="cb204-29"><a href="vulnerability-data.html#cb204-29"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb204-30"><a href="vulnerability-data.html#cb204-30"></a><span class="st">  </span><span class="kw">layout</span>(</span>
<span id="cb204-31"><a href="vulnerability-data.html#cb204-31"></a>    <span class="dt">xaxis =</span> <span class="kw">list</span>(</span>
<span id="cb204-32"><a href="vulnerability-data.html#cb204-32"></a>      <span class="dt">title =</span> <span class="st">&quot;Average Flood Depth&quot;</span>,</span>
<span id="cb204-33"><a href="vulnerability-data.html#cb204-33"></a>      <span class="dt">zeroline =</span> <span class="ot">FALSE</span></span>
<span id="cb204-34"><a href="vulnerability-data.html#cb204-34"></a>    ),</span>
<span id="cb204-35"><a href="vulnerability-data.html#cb204-35"></a>    <span class="dt">yaxis =</span> <span class="kw">list</span>(</span>
<span id="cb204-36"><a href="vulnerability-data.html#cb204-36"></a>      <span class="dt">title =</span> <span class="st">&quot;Percent Damage&quot;</span></span>
<span id="cb204-37"><a href="vulnerability-data.html#cb204-37"></a>    ),</span>
<span id="cb204-38"><a href="vulnerability-data.html#cb204-38"></a>    <span class="dt">title =</span> <span class="st">&quot;East Palo Alto building damage during&lt;br&gt;100-year storm, by base sea level rise&quot;</span></span>
<span id="cb204-39"><a href="vulnerability-data.html#cb204-39"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb204-40"><a href="vulnerability-data.html#cb204-40"></a><span class="st">  </span><span class="kw">config</span>(<span class="dt">displayModeBar =</span> F)</span>
<span id="cb204-41"><a href="vulnerability-data.html#cb204-41"></a></span>
<span id="cb204-42"><a href="vulnerability-data.html#cb204-42"></a>epa_plot</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exposure-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="risk-estimation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": false
});
});
</script>

</body>

</html>
