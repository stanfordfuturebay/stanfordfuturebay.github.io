<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.3 Migration | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R</title>
  <meta name="description" content="2.3 Migration | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="2.3 Migration | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.3 Migration | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R" />
  
  
  

<meta name="author" content="Stanford Future Bay Initiative" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="equity-analysis.html"/>
<link rel="next" href="microdata.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://bay.stanford.edu">Stanford Future Bay Initiative</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="software-setup.html"><a href="software-setup.html"><i class="fa fa-check"></i><b>1.1</b> Software Setup</a></li>
<li class="chapter" data-level="1.2" data-path="rstudio-interface.html"><a href="rstudio-interface.html"><i class="fa fa-check"></i><b>1.2</b> RStudio Interface</a></li>
<li class="chapter" data-level="1.3" data-path="r-markdown-files.html"><a href="r-markdown-files.html"><i class="fa fa-check"></i><b>1.3</b> R Markdown Files</a></li>
<li class="chapter" data-level="1.4" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>1.4</b> GitHub</a></li>
<li class="chapter" data-level="1.5" data-path="reading-and-saving-files.html"><a href="reading-and-saving-files.html"><i class="fa fa-check"></i><b>1.5</b> Reading and saving files</a></li>
<li class="chapter" data-level="1.6" data-path="loops.html"><a href="loops.html"><i class="fa fa-check"></i><b>1.6</b> Loops</a></li>
<li class="chapter" data-level="1.7" data-path="manipulating-data.html"><a href="manipulating-data.html"><i class="fa fa-check"></i><b>1.7</b> Manipulating data</a></li>
<li class="chapter" data-level="1.8" data-path="plots.html"><a href="plots.html"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
<li class="chapter" data-level="1.9" data-path="geospatial-data.html"><a href="geospatial-data.html"><i class="fa fa-check"></i><b>1.9</b> Geospatial data</a></li>
<li class="chapter" data-level="1.10" data-path="assignment-1.html"><a href="assignment-1.html"><i class="fa fa-check"></i><b>1.10</b> Assignment 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="populations.html"><a href="populations.html"><i class="fa fa-check"></i><b>2</b> Populations</a><ul>
<li class="chapter" data-level="2.1" data-path="census-data.html"><a href="census-data.html"><i class="fa fa-check"></i><b>2.1</b> Census data</a></li>
<li class="chapter" data-level="2.2" data-path="equity-analysis.html"><a href="equity-analysis.html"><i class="fa fa-check"></i><b>2.2</b> Equity analysis</a></li>
<li class="chapter" data-level="2.3" data-path="migration.html"><a href="migration.html"><i class="fa fa-check"></i><b>2.3</b> Migration</a></li>
<li class="chapter" data-level="2.4" data-path="microdata.html"><a href="microdata.html"><i class="fa fa-check"></i><b>2.4</b> Microdata</a></li>
<li class="chapter" data-level="2.5" data-path="spatial-subsets.html"><a href="spatial-subsets.html"><i class="fa fa-check"></i><b>2.5</b> Spatial subsets</a></li>
<li class="chapter" data-level="2.6" data-path="assignment-2.html"><a href="assignment-2.html"><i class="fa fa-check"></i><b>2.6</b> Assignment 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="statistics-part-1.html"><a href="statistics-part-1.html"><i class="fa fa-check"></i><b>3</b> Statistics, Part 1</a><ul>
<li class="chapter" data-level="3.1" data-path="probability-distributions.html"><a href="probability-distributions.html"><i class="fa fa-check"></i><b>3.1</b> Probability distributions</a></li>
<li class="chapter" data-level="3.2" data-path="monte-carlo-simulations.html"><a href="monte-carlo-simulations.html"><i class="fa fa-check"></i><b>3.2</b> Monte Carlo simulations</a></li>
<li class="chapter" data-level="3.3" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html"><i class="fa fa-check"></i><b>3.3</b> Simple linear regression</a></li>
<li class="chapter" data-level="3.4" data-path="sampling-bias.html"><a href="sampling-bias.html"><i class="fa fa-check"></i><b>3.4</b> Sampling bias</a></li>
<li class="chapter" data-level="3.5" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>3.5</b> Multiple regression</a></li>
<li class="chapter" data-level="3.6" data-path="assignment-3.html"><a href="assignment-3.html"><i class="fa fa-check"></i><b>3.6</b> Assignment 3</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="statistics-part-2.html"><a href="statistics-part-2.html"><i class="fa fa-check"></i><b>4</b> Statistics, Part 2</a><ul>
<li class="chapter" data-level="4.1" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>4.1</b> Logistic regression</a></li>
<li class="chapter" data-level="4.2" data-path="training-and-testing-data.html"><a href="training-and-testing-data.html"><i class="fa fa-check"></i><b>4.2</b> Training and testing data</a></li>
<li class="chapter" data-level="4.3" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>4.3</b> Matching</a></li>
<li class="chapter" data-level="4.4" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>4.4</b> Difference-in-differences</a></li>
<li class="chapter" data-level="4.5" data-path="assignment-4.html"><a href="assignment-4.html"><i class="fa fa-check"></i><b>4.5</b> Assignment 4</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mobility.html"><a href="mobility.html"><i class="fa fa-check"></i><b>5</b> Mobility</a><ul>
<li class="chapter" data-level="5.1" data-path="travel-survey-data.html"><a href="travel-survey-data.html"><i class="fa fa-check"></i><b>5.1</b> Travel survey data</a></li>
<li class="chapter" data-level="5.2" data-path="commute-data.html"><a href="commute-data.html"><i class="fa fa-check"></i><b>5.2</b> Commute data</a></li>
<li class="chapter" data-level="5.3" data-path="routing.html"><a href="routing.html"><i class="fa fa-check"></i><b>5.3</b> Routing</a></li>
<li class="chapter" data-level="5.4" data-path="accessibility.html"><a href="accessibility.html"><i class="fa fa-check"></i><b>5.4</b> Accessibility</a></li>
<li class="chapter" data-level="5.5" data-path="assignment-5.html"><a href="assignment-5.html"><i class="fa fa-check"></i><b>5.5</b> Assignment 5</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="land-use.html"><a href="land-use.html"><i class="fa fa-check"></i><b>6</b> Land Use</a><ul>
<li class="chapter" data-level="6.1" data-path="housing-data.html"><a href="housing-data.html"><i class="fa fa-check"></i><b>6.1</b> Housing data</a></li>
<li class="chapter" data-level="6.2" data-path="parcel-data.html"><a href="parcel-data.html"><i class="fa fa-check"></i><b>6.2</b> Parcel data</a></li>
<li class="chapter" data-level="6.3" data-path="census-to-parcel-disaggregation.html"><a href="census-to-parcel-disaggregation.html"><i class="fa fa-check"></i><b>6.3</b> Census-to-parcel disaggregation</a></li>
<li class="chapter" data-level="6.4" data-path="parcel-and-building-geometries.html"><a href="parcel-and-building-geometries.html"><i class="fa fa-check"></i><b>6.4</b> Parcel and building geometries</a></li>
<li class="chapter" data-level="6.5" data-path="address-geocoding-and-matching.html"><a href="address-geocoding-and-matching.html"><i class="fa fa-check"></i><b>6.5</b> Address geocoding and matching</a></li>
<li class="chapter" data-level="6.6" data-path="assignment-6.html"><a href="assignment-6.html"><i class="fa fa-check"></i><b>6.6</b> Assignment 6</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sustainability.html"><a href="sustainability.html"><i class="fa fa-check"></i><b>7</b> Sustainability</a><ul>
<li class="chapter" data-level="7.1" data-path="vehicle-emissions.html"><a href="vehicle-emissions.html"><i class="fa fa-check"></i><b>7.1</b> Vehicle emissions</a></li>
<li class="chapter" data-level="7.2" data-path="building-emissions.html"><a href="building-emissions.html"><i class="fa fa-check"></i><b>7.2</b> Building emissions</a></li>
<li class="chapter" data-level="7.3" data-path="air-pollution-data.html"><a href="air-pollution-data.html"><i class="fa fa-check"></i><b>7.3</b> Air pollution data</a></li>
<li class="chapter" data-level="7.4" data-path="household-consumption.html"><a href="household-consumption.html"><i class="fa fa-check"></i><b>7.4</b> Household consumption</a></li>
<li class="chapter" data-level="7.5" data-path="assignment-7.html"><a href="assignment-7.html"><i class="fa fa-check"></i><b>7.5</b> Assignment 7</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="hazards.html"><a href="hazards.html"><i class="fa fa-check"></i><b>8</b> Hazards</a><ul>
<li class="chapter" data-level="8.1" data-path="hazard-data.html"><a href="hazard-data.html"><i class="fa fa-check"></i><b>8.1</b> Hazard data</a></li>
<li class="chapter" data-level="8.2" data-path="exposure-data.html"><a href="exposure-data.html"><i class="fa fa-check"></i><b>8.2</b> Exposure data</a></li>
<li class="chapter" data-level="8.3" data-path="vulnerability-data.html"><a href="vulnerability-data.html"><i class="fa fa-check"></i><b>8.3</b> Vulnerability data</a></li>
<li class="chapter" data-level="8.4" data-path="risk-estimation.html"><a href="risk-estimation.html"><i class="fa fa-check"></i><b>8.4</b> Risk estimation</a></li>
<li class="chapter" data-level="8.5" data-path="assignment-8.html"><a href="assignment-8.html"><i class="fa fa-check"></i><b>8.5</b> Assignment 8</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="web-applications.html"><a href="web-applications.html"><i class="fa fa-check"></i><b>9</b> Web Applications</a><ul>
<li class="chapter" data-level="9.1" data-path="dashboards.html"><a href="dashboards.html"><i class="fa fa-check"></i><b>9.1</b> Dashboards</a></li>
<li class="chapter" data-level="9.2" data-path="assignment-9.html"><a href="assignment-9.html"><i class="fa fa-check"></i><b>9.2</b> Assignment 9</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="migration" class="section level2">
<h2><span class="header-section-number">2.3</span> Migration</h2>
<p>By way of demonstrating more data wrangling with ACS, let’s consider another classic question in urban systems: To what degree has the increase in income in a place like the Bay Area been a result of true economic mobility, and to what degree has it been the result of higher-income newcomers displacing lower-income residents?</p>
<p>Two relevant datasets from the ACS are <code>B07010</code>, “GEOGRAPHICAL MOBILITY IN THE PAST YEAR BY INDIVIDUAL INCOME IN THE PAST 12 MONTHS FOR CURRENT RESIDENCE IN THE UNITED STATES”, and <code>B07410</code>, “GEOGRAPHICAL MOBILITY IN THE PAST YEAR BY INDIVIDUAL INCOME IN THE PAST 12 MONTHS FOR RESIDENCE 1 YEAR AGO IN THE UNITED STATES”. The difference is that <code>B07010</code> counts the current population in the given year, a combination of “people who’ve remained” and “people who’ve immigrated in”, while <code>B07410</code> counts “people who’ve remained” and “people who were here a year ago but emigrated somewhere else”. From these two datasets, you can get “inflow” and “outflow”, which make “external net flow”. You’ll also find that subtracting total population last year (obtained by grabbing <code>B07010</code> from the previous year) from total population this year does not equal “external net flow”, so whatever’s left is “internal net flow”, a combination of births and deaths (there may also be untracked migration abroad, which we assume to be negligible compared to the other counts). By the way, these datasets also provide breakdowns by income tiers for every buckets, so “external net flow” in and out of each income tier can be captured, as well as some amount of internal economic mobility across income tiers.</p>
<p>Let’s first try loading in <code>B07010</code> for 2019. We’ll focus our analysis on San Mateo County, FIPS code <code>081</code>, because the dataset only clearly delineates movement in and out of the county level.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="migration.html#cb89-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb89-2"><a href="migration.html#cb89-2"></a><span class="kw">library</span>(censusapi)</span>
<span id="cb89-3"><a href="migration.html#cb89-3"></a></span>
<span id="cb89-4"><a href="migration.html#cb89-4"></a><span class="kw">Sys.setenv</span>(<span class="dt">CENSUS_KEY=</span><span class="st">&quot;c8aa67e4086b4b5ce3a8717f59faa9a28f611dab&quot;</span>)</span>
<span id="cb89-5"><a href="migration.html#cb89-5"></a></span>
<span id="cb89-6"><a href="migration.html#cb89-6"></a>acs_vars_<span class="dv">2019</span>_1yr &lt;-</span>
<span id="cb89-7"><a href="migration.html#cb89-7"></a><span class="st">  </span><span class="kw">listCensusMetadata</span>(</span>
<span id="cb89-8"><a href="migration.html#cb89-8"></a>    <span class="dt">name =</span> <span class="st">&quot;2019/acs/acs1&quot;</span>,</span>
<span id="cb89-9"><a href="migration.html#cb89-9"></a>    <span class="dt">type =</span> <span class="st">&quot;variables&quot;</span></span>
<span id="cb89-10"><a href="migration.html#cb89-10"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="migration.html#cb90-1"></a>smc_mobility_current_<span class="dv">19</span> &lt;-<span class="st"> </span></span>
<span id="cb90-2"><a href="migration.html#cb90-2"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb90-3"><a href="migration.html#cb90-3"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs1&quot;</span>,</span>
<span id="cb90-4"><a href="migration.html#cb90-4"></a>    <span class="dt">vintage =</span> <span class="dv">2019</span>,</span>
<span id="cb90-5"><a href="migration.html#cb90-5"></a>    <span class="dt">region =</span> <span class="st">&quot;county:081&quot;</span>,</span>
<span id="cb90-6"><a href="migration.html#cb90-6"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:06&quot;</span>,</span>
<span id="cb90-7"><a href="migration.html#cb90-7"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;group(B07010)&quot;</span>)</span>
<span id="cb90-8"><a href="migration.html#cb90-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-9"><a href="migration.html#cb90-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(GEO_ID,state,NAME) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;MA&quot;</span>,<span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb90-10"><a href="migration.html#cb90-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb90-11"><a href="migration.html#cb90-11"></a>    <span class="kw">ends_with</span>(<span class="st">&quot;E&quot;</span>),</span>
<span id="cb90-12"><a href="migration.html#cb90-12"></a>    <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb90-13"><a href="migration.html#cb90-13"></a>    <span class="dt">values_to =</span> <span class="st">&quot;estimate&quot;</span></span>
<span id="cb90-14"><a href="migration.html#cb90-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb90-15"><a href="migration.html#cb90-15"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb90-16"><a href="migration.html#cb90-16"></a>    acs_vars_<span class="dv">2019</span>_1yr <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-17"><a href="migration.html#cb90-17"></a><span class="st">      </span><span class="kw">select</span>(name, label), </span>
<span id="cb90-18"><a href="migration.html#cb90-18"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span> =<span class="st"> &quot;name&quot;</span>)</span>
<span id="cb90-19"><a href="migration.html#cb90-19"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-20"><a href="migration.html#cb90-20"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>variable)</span></code></pre></div>
<p>For any new ACS dataset loaded using <code>censusapi</code>, you’ll want to check the <code>label</code> field (<code>smc_mobility_current_19$label</code> in Console) to understand the nested structure of the data. Remember, if you aren’t careful with how you work with this data, you could easily double-count. This step is always a kind of puzzle that you want to figure out how to solve in the simplest way possible. The following is a solution to this particular puzzle, based on an understanding of which rows are duplicative, and what categorization we ultimately want, where “Same house 1 year ago:” and “Moved within the same county:” are considered “Here since last year”, while “Moved from different county within same state:”, “Moved from different state:”, and “Moved from abroad:” are considered “Inflow”.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="migration.html#cb91-1"></a>smc_mobility_current_<span class="dv">19</span> &lt;-<span class="st"> </span></span>
<span id="cb91-2"><a href="migration.html#cb91-2"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb91-3"><a href="migration.html#cb91-3"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs1&quot;</span>,</span>
<span id="cb91-4"><a href="migration.html#cb91-4"></a>    <span class="dt">vintage =</span> <span class="dv">2019</span>,</span>
<span id="cb91-5"><a href="migration.html#cb91-5"></a>    <span class="dt">region =</span> <span class="st">&quot;county:081&quot;</span>,</span>
<span id="cb91-6"><a href="migration.html#cb91-6"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:06&quot;</span>,</span>
<span id="cb91-7"><a href="migration.html#cb91-7"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;group(B07010)&quot;</span>)</span>
<span id="cb91-8"><a href="migration.html#cb91-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-9"><a href="migration.html#cb91-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(GEO_ID,state,NAME) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;MA&quot;</span>,<span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb91-10"><a href="migration.html#cb91-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb91-11"><a href="migration.html#cb91-11"></a>    <span class="kw">ends_with</span>(<span class="st">&quot;E&quot;</span>),</span>
<span id="cb91-12"><a href="migration.html#cb91-12"></a>    <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb91-13"><a href="migration.html#cb91-13"></a>    <span class="dt">values_to =</span> <span class="st">&quot;estimate&quot;</span></span>
<span id="cb91-14"><a href="migration.html#cb91-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb91-15"><a href="migration.html#cb91-15"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb91-16"><a href="migration.html#cb91-16"></a>    acs_vars_<span class="dv">2019</span>_1yr <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-17"><a href="migration.html#cb91-17"></a><span class="st">      </span><span class="kw">select</span>(name, label), </span>
<span id="cb91-18"><a href="migration.html#cb91-18"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span> =<span class="st"> &quot;name&quot;</span>)</span>
<span id="cb91-19"><a href="migration.html#cb91-19"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-20"><a href="migration.html#cb91-20"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>variable) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-21"><a href="migration.html#cb91-21"></a><span class="st">  </span><span class="kw">separate</span>(</span>
<span id="cb91-22"><a href="migration.html#cb91-22"></a>    label,</span>
<span id="cb91-23"><a href="migration.html#cb91-23"></a>    <span class="dt">into =</span> <span class="kw">c</span>(<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="st">&quot;mobility&quot;</span>,<span class="st">&quot;temp&quot;</span>,<span class="st">&quot;income&quot;</span>),</span>
<span id="cb91-24"><a href="migration.html#cb91-24"></a>    <span class="dt">sep =</span> <span class="st">&quot;!!&quot;</span></span>
<span id="cb91-25"><a href="migration.html#cb91-25"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-26"><a href="migration.html#cb91-26"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb91-27"><a href="migration.html#cb91-27"></a>    <span class="dt">income =</span> <span class="kw">ifelse</span>(</span>
<span id="cb91-28"><a href="migration.html#cb91-28"></a>      temp <span class="op">==</span><span class="st"> &quot;No income&quot;</span>,</span>
<span id="cb91-29"><a href="migration.html#cb91-29"></a>      temp,</span>
<span id="cb91-30"><a href="migration.html#cb91-30"></a>      income</span>
<span id="cb91-31"><a href="migration.html#cb91-31"></a>    ),</span>
<span id="cb91-32"><a href="migration.html#cb91-32"></a>    <span class="dt">mobility =</span> <span class="kw">ifelse</span>(</span>
<span id="cb91-33"><a href="migration.html#cb91-33"></a>      mobility <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Same house 1 year ago:&quot;</span>, <span class="st">&quot;Moved within same county:&quot;</span>),</span>
<span id="cb91-34"><a href="migration.html#cb91-34"></a>      <span class="st">&quot;Here since last year&quot;</span>,</span>
<span id="cb91-35"><a href="migration.html#cb91-35"></a>      <span class="st">&quot;Inflow&quot;</span></span>
<span id="cb91-36"><a href="migration.html#cb91-36"></a>    )</span>
<span id="cb91-37"><a href="migration.html#cb91-37"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-38"><a href="migration.html#cb91-38"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(income)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-39"><a href="migration.html#cb91-39"></a><span class="st">  </span><span class="kw">group_by</span>(mobility, income) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-40"><a href="migration.html#cb91-40"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">estimate =</span> <span class="kw">sum</span>(estimate))</span></code></pre></div>
<p>The resultant tidy dataframe has counts of individuals (which by the way, is the universe of people over the age of 15) by income tier and by “Here since last year” or “Inflow”.</p>
<p>Next, we repeat these two steps for <code>B07410</code> in 2019:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="migration.html#cb92-1"></a>smc_mobility_lastyear_<span class="dv">19</span> &lt;-<span class="st"> </span></span>
<span id="cb92-2"><a href="migration.html#cb92-2"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb92-3"><a href="migration.html#cb92-3"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs1&quot;</span>,</span>
<span id="cb92-4"><a href="migration.html#cb92-4"></a>    <span class="dt">vintage =</span> <span class="dv">2019</span>,</span>
<span id="cb92-5"><a href="migration.html#cb92-5"></a>    <span class="dt">region =</span> <span class="st">&quot;county:081&quot;</span>,</span>
<span id="cb92-6"><a href="migration.html#cb92-6"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:06&quot;</span>,</span>
<span id="cb92-7"><a href="migration.html#cb92-7"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;group(B07410)&quot;</span>)</span>
<span id="cb92-8"><a href="migration.html#cb92-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-9"><a href="migration.html#cb92-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(GEO_ID,state,NAME) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;MA&quot;</span>,<span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb92-10"><a href="migration.html#cb92-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb92-11"><a href="migration.html#cb92-11"></a>    <span class="kw">ends_with</span>(<span class="st">&quot;E&quot;</span>),</span>
<span id="cb92-12"><a href="migration.html#cb92-12"></a>    <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb92-13"><a href="migration.html#cb92-13"></a>    <span class="dt">values_to =</span> <span class="st">&quot;estimate&quot;</span></span>
<span id="cb92-14"><a href="migration.html#cb92-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb92-15"><a href="migration.html#cb92-15"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb92-16"><a href="migration.html#cb92-16"></a>    acs_vars_<span class="dv">2019</span>_1yr <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-17"><a href="migration.html#cb92-17"></a><span class="st">      </span><span class="kw">select</span>(name, label), </span>
<span id="cb92-18"><a href="migration.html#cb92-18"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span> =<span class="st"> &quot;name&quot;</span>)</span>
<span id="cb92-19"><a href="migration.html#cb92-19"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb92-20"><a href="migration.html#cb92-20"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>variable)</span></code></pre></div>
<p>You’ll notice there are fewer labels overall. Since people who move abroad between 2018 and 2019 wouldn’t take an ACS survey in 2019, they are “lost”.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="migration.html#cb93-1"></a>smc_mobility_lastyear_<span class="dv">19</span> &lt;-<span class="st"> </span></span>
<span id="cb93-2"><a href="migration.html#cb93-2"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb93-3"><a href="migration.html#cb93-3"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs1&quot;</span>,</span>
<span id="cb93-4"><a href="migration.html#cb93-4"></a>    <span class="dt">vintage =</span> <span class="dv">2019</span>,</span>
<span id="cb93-5"><a href="migration.html#cb93-5"></a>    <span class="dt">region =</span> <span class="st">&quot;county:081&quot;</span>,</span>
<span id="cb93-6"><a href="migration.html#cb93-6"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:06&quot;</span>,</span>
<span id="cb93-7"><a href="migration.html#cb93-7"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;group(B07410)&quot;</span>)</span>
<span id="cb93-8"><a href="migration.html#cb93-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-9"><a href="migration.html#cb93-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(GEO_ID,state,NAME) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;MA&quot;</span>,<span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb93-10"><a href="migration.html#cb93-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb93-11"><a href="migration.html#cb93-11"></a>    <span class="kw">ends_with</span>(<span class="st">&quot;E&quot;</span>),</span>
<span id="cb93-12"><a href="migration.html#cb93-12"></a>    <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb93-13"><a href="migration.html#cb93-13"></a>    <span class="dt">values_to =</span> <span class="st">&quot;estimate&quot;</span></span>
<span id="cb93-14"><a href="migration.html#cb93-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb93-15"><a href="migration.html#cb93-15"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb93-16"><a href="migration.html#cb93-16"></a>    acs_vars_<span class="dv">2019</span>_1yr <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-17"><a href="migration.html#cb93-17"></a><span class="st">      </span><span class="kw">select</span>(name, label), </span>
<span id="cb93-18"><a href="migration.html#cb93-18"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span> =<span class="st"> &quot;name&quot;</span>)</span>
<span id="cb93-19"><a href="migration.html#cb93-19"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-20"><a href="migration.html#cb93-20"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>variable) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-21"><a href="migration.html#cb93-21"></a><span class="st">  </span><span class="kw">separate</span>(</span>
<span id="cb93-22"><a href="migration.html#cb93-22"></a>    label,</span>
<span id="cb93-23"><a href="migration.html#cb93-23"></a>    <span class="dt">into =</span> <span class="kw">c</span>(<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="st">&quot;mobility&quot;</span>,<span class="st">&quot;temp&quot;</span>,<span class="st">&quot;income&quot;</span>),</span>
<span id="cb93-24"><a href="migration.html#cb93-24"></a>    <span class="dt">sep =</span> <span class="st">&quot;!!&quot;</span></span>
<span id="cb93-25"><a href="migration.html#cb93-25"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-26"><a href="migration.html#cb93-26"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb93-27"><a href="migration.html#cb93-27"></a>    <span class="dt">income =</span> <span class="kw">ifelse</span>(</span>
<span id="cb93-28"><a href="migration.html#cb93-28"></a>      temp <span class="op">==</span><span class="st"> &quot;No income&quot;</span>,</span>
<span id="cb93-29"><a href="migration.html#cb93-29"></a>      temp,</span>
<span id="cb93-30"><a href="migration.html#cb93-30"></a>      income</span>
<span id="cb93-31"><a href="migration.html#cb93-31"></a>    ),</span>
<span id="cb93-32"><a href="migration.html#cb93-32"></a>    <span class="dt">mobility =</span> <span class="kw">ifelse</span>(</span>
<span id="cb93-33"><a href="migration.html#cb93-33"></a>      mobility <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Same house:&quot;</span>, <span class="st">&quot;Moved within same county:&quot;</span>),</span>
<span id="cb93-34"><a href="migration.html#cb93-34"></a>      <span class="st">&quot;Here since last year&quot;</span>,</span>
<span id="cb93-35"><a href="migration.html#cb93-35"></a>      <span class="st">&quot;Outflow&quot;</span></span>
<span id="cb93-36"><a href="migration.html#cb93-36"></a>    )</span>
<span id="cb93-37"><a href="migration.html#cb93-37"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-38"><a href="migration.html#cb93-38"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(income)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-39"><a href="migration.html#cb93-39"></a><span class="st">  </span><span class="kw">group_by</span>(mobility, income) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-40"><a href="migration.html#cb93-40"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">estimate =</span> <span class="kw">sum</span>(estimate))</span></code></pre></div>
<p>By the way, at this point you can compare the two dataframes and verify that “Here since last year” is the same between the two, which you would expect.</p>
<p>Finally, we need “total population” as recorded in 2018, which we could potentially get from other sources, but we’ll just use <code>B07010</code>, and summarize the information such that we end up with just total population by income tiers.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="migration.html#cb94-1"></a>smc_mobility_current_<span class="dv">18</span> &lt;-<span class="st"> </span></span>
<span id="cb94-2"><a href="migration.html#cb94-2"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb94-3"><a href="migration.html#cb94-3"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs1&quot;</span>,</span>
<span id="cb94-4"><a href="migration.html#cb94-4"></a>    <span class="dt">vintage =</span> <span class="dv">2018</span>,</span>
<span id="cb94-5"><a href="migration.html#cb94-5"></a>    <span class="dt">region =</span> <span class="st">&quot;county:081&quot;</span>,</span>
<span id="cb94-6"><a href="migration.html#cb94-6"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:06&quot;</span>,</span>
<span id="cb94-7"><a href="migration.html#cb94-7"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;group(B07010)&quot;</span>)</span>
<span id="cb94-8"><a href="migration.html#cb94-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-9"><a href="migration.html#cb94-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(GEO_ID,state,NAME) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;MA&quot;</span>,<span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb94-10"><a href="migration.html#cb94-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb94-11"><a href="migration.html#cb94-11"></a>    <span class="kw">ends_with</span>(<span class="st">&quot;E&quot;</span>),</span>
<span id="cb94-12"><a href="migration.html#cb94-12"></a>    <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb94-13"><a href="migration.html#cb94-13"></a>    <span class="dt">values_to =</span> <span class="st">&quot;estimate&quot;</span></span>
<span id="cb94-14"><a href="migration.html#cb94-14"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb94-15"><a href="migration.html#cb94-15"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb94-16"><a href="migration.html#cb94-16"></a>    acs_vars_<span class="dv">2019</span>_1yr <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-17"><a href="migration.html#cb94-17"></a><span class="st">      </span><span class="kw">select</span>(name, label), </span>
<span id="cb94-18"><a href="migration.html#cb94-18"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span> =<span class="st"> &quot;name&quot;</span>)</span>
<span id="cb94-19"><a href="migration.html#cb94-19"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-20"><a href="migration.html#cb94-20"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>variable) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-21"><a href="migration.html#cb94-21"></a><span class="st">  </span><span class="kw">separate</span>(</span>
<span id="cb94-22"><a href="migration.html#cb94-22"></a>    label,</span>
<span id="cb94-23"><a href="migration.html#cb94-23"></a>    <span class="dt">into =</span> <span class="kw">c</span>(<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="st">&quot;mobility&quot;</span>,<span class="st">&quot;temp&quot;</span>,<span class="st">&quot;income&quot;</span>),</span>
<span id="cb94-24"><a href="migration.html#cb94-24"></a>    <span class="dt">sep =</span> <span class="st">&quot;!!&quot;</span></span>
<span id="cb94-25"><a href="migration.html#cb94-25"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-26"><a href="migration.html#cb94-26"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb94-27"><a href="migration.html#cb94-27"></a>    <span class="dt">income =</span> <span class="kw">ifelse</span>(</span>
<span id="cb94-28"><a href="migration.html#cb94-28"></a>      temp <span class="op">==</span><span class="st"> &quot;No income&quot;</span>,</span>
<span id="cb94-29"><a href="migration.html#cb94-29"></a>      temp,</span>
<span id="cb94-30"><a href="migration.html#cb94-30"></a>      income</span>
<span id="cb94-31"><a href="migration.html#cb94-31"></a>    ),</span>
<span id="cb94-32"><a href="migration.html#cb94-32"></a>    <span class="dt">mobility =</span> <span class="st">&quot;Here last year&quot;</span></span>
<span id="cb94-33"><a href="migration.html#cb94-33"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-34"><a href="migration.html#cb94-34"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(income)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-35"><a href="migration.html#cb94-35"></a><span class="st">  </span><span class="kw">group_by</span>(mobility, income) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-36"><a href="migration.html#cb94-36"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">estimate =</span> <span class="kw">sum</span>(estimate))</span></code></pre></div>
<p>Now, we can bind these dataframes together in a specific way so that we only hold on to counts of “Here last year”, “Here this year”, “Outflow”, and “Inflow”. We’ll also pivot the table to wide format so we can <code>mutate()</code> some new fields for internal and external net flow.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="migration.html#cb95-1"></a>smc_flows_<span class="dv">19</span> &lt;-</span>
<span id="cb95-2"><a href="migration.html#cb95-2"></a><span class="st">  </span><span class="kw">rbind</span>(</span>
<span id="cb95-3"><a href="migration.html#cb95-3"></a>    smc_mobility_current_<span class="dv">18</span>,</span>
<span id="cb95-4"><a href="migration.html#cb95-4"></a>    smc_mobility_lastyear_<span class="dv">19</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-5"><a href="migration.html#cb95-5"></a><span class="st">      </span><span class="kw">filter</span>(mobility <span class="op">==</span><span class="st"> &quot;Outflow&quot;</span>),</span>
<span id="cb95-6"><a href="migration.html#cb95-6"></a>    smc_mobility_current_<span class="dv">19</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-7"><a href="migration.html#cb95-7"></a><span class="st">      </span><span class="kw">filter</span>(mobility <span class="op">==</span><span class="st"> &quot;Inflow&quot;</span>),</span>
<span id="cb95-8"><a href="migration.html#cb95-8"></a>    smc_mobility_current_<span class="dv">19</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-9"><a href="migration.html#cb95-9"></a><span class="st">      </span><span class="kw">group_by</span>(income) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-10"><a href="migration.html#cb95-10"></a><span class="st">      </span><span class="kw">summarize</span>(<span class="dt">estimate =</span> <span class="kw">sum</span>(estimate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-11"><a href="migration.html#cb95-11"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">mobility =</span> <span class="st">&quot;Here this year&quot;</span>)</span>
<span id="cb95-12"><a href="migration.html#cb95-12"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-13"><a href="migration.html#cb95-13"></a><span class="st">  </span><span class="kw">pivot_wider</span>(</span>
<span id="cb95-14"><a href="migration.html#cb95-14"></a>    <span class="dt">names_from =</span> mobility,</span>
<span id="cb95-15"><a href="migration.html#cb95-15"></a>    <span class="dt">values_from =</span> estimate</span>
<span id="cb95-16"><a href="migration.html#cb95-16"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-17"><a href="migration.html#cb95-17"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb95-18"><a href="migration.html#cb95-18"></a>    <span class="st">`</span><span class="dt">External net</span><span class="st">`</span> =<span class="st"> </span>Inflow <span class="op">-</span><span class="st"> </span>Outflow,</span>
<span id="cb95-19"><a href="migration.html#cb95-19"></a>    <span class="st">`</span><span class="dt">Internal net</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">Here this year</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">Here last year</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">External net</span><span class="st">`</span>,</span>
<span id="cb95-20"><a href="migration.html#cb95-20"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb95-21"><a href="migration.html#cb95-21"></a><span class="st">  </span><span class="kw">select</span>(</span>
<span id="cb95-22"><a href="migration.html#cb95-22"></a>    <span class="st">`</span><span class="dt">Income tier</span><span class="st">`</span> =<span class="st"> </span>income, </span>
<span id="cb95-23"><a href="migration.html#cb95-23"></a>    <span class="st">`</span><span class="dt">Internal net</span><span class="st">`</span>,</span>
<span id="cb95-24"><a href="migration.html#cb95-24"></a>    <span class="st">`</span><span class="dt">External net</span><span class="st">`</span>,</span>
<span id="cb95-25"><a href="migration.html#cb95-25"></a>    <span class="st">`</span><span class="dt">Here last year</span><span class="st">`</span>, </span>
<span id="cb95-26"><a href="migration.html#cb95-26"></a>    <span class="st">`</span><span class="dt">Here this year</span><span class="st">`</span>, </span>
<span id="cb95-27"><a href="migration.html#cb95-27"></a>    Outflow, </span>
<span id="cb95-28"><a href="migration.html#cb95-28"></a>    Inflow</span>
<span id="cb95-29"><a href="migration.html#cb95-29"></a>  )</span>
<span id="cb95-30"><a href="migration.html#cb95-30"></a></span>
<span id="cb95-31"><a href="migration.html#cb95-31"></a>smc_flows_<span class="dv">19</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Income tier"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Internal net"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["External net"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Here last year"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Here this year"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Outflow"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Inflow"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"$1 to $9,999 or loss","2":"-9815","3":"-2080","4":"68227","5":"56332","6":"6779","7":"4699"},{"1":"$10,000 to $14,999","2":"-5861","3":"1128","4":"38523","5":"33790","6":"1159","7":"2287"},{"1":"$15,000 to $24,999","2":"-2203","3":"-40","4":"57838","5":"55595","6":"2959","7":"2919"},{"1":"$25,000 to $34,999","2":"-2149","3":"-271","4":"50807","5":"48387","6":"3513","7":"3242"},{"1":"$35,000 to $49,999","2":"6886","3":"-718","4":"60877","5":"67045","6":"4726","7":"4008"},{"1":"$50,000 to $64,999","2":"1673","3":"326","4":"54182","5":"56181","6":"2963","7":"3289"},{"1":"$65,000 to $74,999","2":"2084","3":"-11","4":"25956","5":"28029","6":"2019","7":"2008"},{"1":"$75,000 or more","2":"11920","3":"-764","4":"204166","5":"215322","6":"15858","7":"15094"},{"1":"No income","2":"1022","3":"253","4":"76355","5":"77630","6":"5261","7":"5514"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>I’ll leave you to reflect on this result, and what it suggests about the answer to the initial question posed in this section.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="equity-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="microdata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": false,
"info": false
});
});
</script>

</body>

</html>
