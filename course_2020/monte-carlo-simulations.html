<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.2 Monte Carlo simulations | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R</title>
  <meta name="description" content="3.2 Monte Carlo simulations | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="3.2 Monte Carlo simulations | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.2 Monte Carlo simulations | Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R" />
  
  
  

<meta name="author" content="Stanford Future Bay Initiative" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="probability-distributions.html"/>
<link rel="next" href="simple-linear-regression.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://bay.stanford.edu">Stanford Future Bay Initiative</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="software-setup.html"><a href="software-setup.html"><i class="fa fa-check"></i><b>1.1</b> Software Setup</a></li>
<li class="chapter" data-level="1.2" data-path="rstudio-interface.html"><a href="rstudio-interface.html"><i class="fa fa-check"></i><b>1.2</b> RStudio Interface</a></li>
<li class="chapter" data-level="1.3" data-path="r-markdown-files.html"><a href="r-markdown-files.html"><i class="fa fa-check"></i><b>1.3</b> R Markdown Files</a></li>
<li class="chapter" data-level="1.4" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>1.4</b> GitHub</a></li>
<li class="chapter" data-level="1.5" data-path="reading-and-saving-files.html"><a href="reading-and-saving-files.html"><i class="fa fa-check"></i><b>1.5</b> Reading and saving files</a></li>
<li class="chapter" data-level="1.6" data-path="loops.html"><a href="loops.html"><i class="fa fa-check"></i><b>1.6</b> Loops</a></li>
<li class="chapter" data-level="1.7" data-path="manipulating-data.html"><a href="manipulating-data.html"><i class="fa fa-check"></i><b>1.7</b> Manipulating data</a></li>
<li class="chapter" data-level="1.8" data-path="plots.html"><a href="plots.html"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
<li class="chapter" data-level="1.9" data-path="geospatial-data.html"><a href="geospatial-data.html"><i class="fa fa-check"></i><b>1.9</b> Geospatial data</a></li>
<li class="chapter" data-level="1.10" data-path="assignment-1.html"><a href="assignment-1.html"><i class="fa fa-check"></i><b>1.10</b> Assignment 1</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="populations.html"><a href="populations.html"><i class="fa fa-check"></i><b>2</b> Populations</a><ul>
<li class="chapter" data-level="2.1" data-path="census-data.html"><a href="census-data.html"><i class="fa fa-check"></i><b>2.1</b> Census data</a></li>
<li class="chapter" data-level="2.2" data-path="equity-analysis.html"><a href="equity-analysis.html"><i class="fa fa-check"></i><b>2.2</b> Equity analysis</a></li>
<li class="chapter" data-level="2.3" data-path="migration.html"><a href="migration.html"><i class="fa fa-check"></i><b>2.3</b> Migration</a></li>
<li class="chapter" data-level="2.4" data-path="microdata.html"><a href="microdata.html"><i class="fa fa-check"></i><b>2.4</b> Microdata</a></li>
<li class="chapter" data-level="2.5" data-path="spatial-subsets.html"><a href="spatial-subsets.html"><i class="fa fa-check"></i><b>2.5</b> Spatial subsets</a></li>
<li class="chapter" data-level="2.6" data-path="assignment-2.html"><a href="assignment-2.html"><i class="fa fa-check"></i><b>2.6</b> Assignment 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="statistics-part-1.html"><a href="statistics-part-1.html"><i class="fa fa-check"></i><b>3</b> Statistics, Part 1</a><ul>
<li class="chapter" data-level="3.1" data-path="probability-distributions.html"><a href="probability-distributions.html"><i class="fa fa-check"></i><b>3.1</b> Probability distributions</a></li>
<li class="chapter" data-level="3.2" data-path="monte-carlo-simulations.html"><a href="monte-carlo-simulations.html"><i class="fa fa-check"></i><b>3.2</b> Monte Carlo simulations</a></li>
<li class="chapter" data-level="3.3" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html"><i class="fa fa-check"></i><b>3.3</b> Simple linear regression</a></li>
<li class="chapter" data-level="3.4" data-path="sampling-bias.html"><a href="sampling-bias.html"><i class="fa fa-check"></i><b>3.4</b> Sampling bias</a></li>
<li class="chapter" data-level="3.5" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>3.5</b> Multiple regression</a></li>
<li class="chapter" data-level="3.6" data-path="assignment-3.html"><a href="assignment-3.html"><i class="fa fa-check"></i><b>3.6</b> Assignment 3</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="statistics-part-2.html"><a href="statistics-part-2.html"><i class="fa fa-check"></i><b>4</b> Statistics, Part 2</a><ul>
<li class="chapter" data-level="4.1" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>4.1</b> Logistic regression</a></li>
<li class="chapter" data-level="4.2" data-path="training-and-testing-data.html"><a href="training-and-testing-data.html"><i class="fa fa-check"></i><b>4.2</b> Training and testing data</a></li>
<li class="chapter" data-level="4.3" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>4.3</b> Matching</a></li>
<li class="chapter" data-level="4.4" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>4.4</b> Difference-in-differences</a></li>
<li class="chapter" data-level="4.5" data-path="assignment-4.html"><a href="assignment-4.html"><i class="fa fa-check"></i><b>4.5</b> Assignment 4</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mobility.html"><a href="mobility.html"><i class="fa fa-check"></i><b>5</b> Mobility</a><ul>
<li class="chapter" data-level="5.1" data-path="travel-survey-data.html"><a href="travel-survey-data.html"><i class="fa fa-check"></i><b>5.1</b> Travel survey data</a></li>
<li class="chapter" data-level="5.2" data-path="commute-data.html"><a href="commute-data.html"><i class="fa fa-check"></i><b>5.2</b> Commute data</a></li>
<li class="chapter" data-level="5.3" data-path="routing.html"><a href="routing.html"><i class="fa fa-check"></i><b>5.3</b> Routing</a></li>
<li class="chapter" data-level="5.4" data-path="accessibility.html"><a href="accessibility.html"><i class="fa fa-check"></i><b>5.4</b> Accessibility</a></li>
<li class="chapter" data-level="5.5" data-path="assignment-5.html"><a href="assignment-5.html"><i class="fa fa-check"></i><b>5.5</b> Assignment 5</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="land-use.html"><a href="land-use.html"><i class="fa fa-check"></i><b>6</b> Land Use</a><ul>
<li class="chapter" data-level="6.1" data-path="housing-data.html"><a href="housing-data.html"><i class="fa fa-check"></i><b>6.1</b> Housing data</a></li>
<li class="chapter" data-level="6.2" data-path="parcel-data.html"><a href="parcel-data.html"><i class="fa fa-check"></i><b>6.2</b> Parcel data</a></li>
<li class="chapter" data-level="6.3" data-path="census-to-parcel-disaggregation.html"><a href="census-to-parcel-disaggregation.html"><i class="fa fa-check"></i><b>6.3</b> Census-to-parcel disaggregation</a></li>
<li class="chapter" data-level="6.4" data-path="parcel-and-building-geometries.html"><a href="parcel-and-building-geometries.html"><i class="fa fa-check"></i><b>6.4</b> Parcel and building geometries</a></li>
<li class="chapter" data-level="6.5" data-path="address-geocoding-and-matching.html"><a href="address-geocoding-and-matching.html"><i class="fa fa-check"></i><b>6.5</b> Address geocoding and matching</a></li>
<li class="chapter" data-level="6.6" data-path="assignment-6.html"><a href="assignment-6.html"><i class="fa fa-check"></i><b>6.6</b> Assignment 6</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sustainability.html"><a href="sustainability.html"><i class="fa fa-check"></i><b>7</b> Sustainability</a><ul>
<li class="chapter" data-level="7.1" data-path="vehicle-emissions.html"><a href="vehicle-emissions.html"><i class="fa fa-check"></i><b>7.1</b> Vehicle emissions</a></li>
<li class="chapter" data-level="7.2" data-path="building-emissions.html"><a href="building-emissions.html"><i class="fa fa-check"></i><b>7.2</b> Building emissions</a></li>
<li class="chapter" data-level="7.3" data-path="air-pollution-data.html"><a href="air-pollution-data.html"><i class="fa fa-check"></i><b>7.3</b> Air pollution data</a></li>
<li class="chapter" data-level="7.4" data-path="household-consumption.html"><a href="household-consumption.html"><i class="fa fa-check"></i><b>7.4</b> Household consumption</a></li>
<li class="chapter" data-level="7.5" data-path="assignment-7.html"><a href="assignment-7.html"><i class="fa fa-check"></i><b>7.5</b> Assignment 7</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="hazards.html"><a href="hazards.html"><i class="fa fa-check"></i><b>8</b> Hazards</a><ul>
<li class="chapter" data-level="8.1" data-path="hazard-data.html"><a href="hazard-data.html"><i class="fa fa-check"></i><b>8.1</b> Hazard data</a></li>
<li class="chapter" data-level="8.2" data-path="exposure-data.html"><a href="exposure-data.html"><i class="fa fa-check"></i><b>8.2</b> Exposure data</a></li>
<li class="chapter" data-level="8.3" data-path="vulnerability-data.html"><a href="vulnerability-data.html"><i class="fa fa-check"></i><b>8.3</b> Vulnerability data</a></li>
<li class="chapter" data-level="8.4" data-path="risk-estimation.html"><a href="risk-estimation.html"><i class="fa fa-check"></i><b>8.4</b> Risk estimation</a></li>
<li class="chapter" data-level="8.5" data-path="assignment-8.html"><a href="assignment-8.html"><i class="fa fa-check"></i><b>8.5</b> Assignment 8</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="web-applications.html"><a href="web-applications.html"><i class="fa fa-check"></i><b>9</b> Web Applications</a><ul>
<li class="chapter" data-level="9.1" data-path="dashboards.html"><a href="dashboards.html"><i class="fa fa-check"></i><b>9.1</b> Dashboards</a></li>
<li class="chapter" data-level="9.2" data-path="assignment-9.html"><a href="assignment-9.html"><i class="fa fa-check"></i><b>9.2</b> Assignment 9</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Shaping the Future of the Bay Area: Intro to Urban Data Analytics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="monte-carlo-simulations" class="section level2">
<h2><span class="header-section-number">3.2</span> Monte Carlo simulations</h2>
<p>It is common for the inputs to some analysis to really be “average” values for some sample or population. Sometimes, you will not have any other information other than the mean, so you’d just work through your analysis, business as usual, and end up with some kind of output based on those input means. But sometimes, you’ll know some measure of variance associated with one or more inputs. In that case, you can set up your R analyses to “propagate” those uncertainties through the analysis and know something about the variance associated with your outputs. The simplest version of this involves “brute force”, i.e. running your analysis thousands of times, each time using <code>rnorm()</code> to introduce some variation to your input values around their means, then measuring the variance of your thousands of different output results. This is often called a “Monte Carlo simulation”, though in some sense, even the Galton experiment from the last section was a kind of Monte Carlo simulation.</p>
<p>Let’s revisit the American Communities Survey as an example. If we wanted to find the median household income for the 9-County Bay Area in 2019, first without considering uncertainty, we can use <code>censusapi</code> as follows:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="monte-carlo-simulations.html#cb122-1"></a>income_<span class="dv">19</span>_summary &lt;-<span class="st"> </span></span>
<span id="cb122-2"><a href="monte-carlo-simulations.html#cb122-2"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb122-3"><a href="monte-carlo-simulations.html#cb122-3"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs1&quot;</span>,</span>
<span id="cb122-4"><a href="monte-carlo-simulations.html#cb122-4"></a>    <span class="dt">vintage =</span> <span class="dv">2019</span>,</span>
<span id="cb122-5"><a href="monte-carlo-simulations.html#cb122-5"></a>    <span class="dt">region =</span> <span class="st">&quot;county:001,013,041,055,075,081,085,095,097&quot;</span>,</span>
<span id="cb122-6"><a href="monte-carlo-simulations.html#cb122-6"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:06&quot;</span>,</span>
<span id="cb122-7"><a href="monte-carlo-simulations.html#cb122-7"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;group(B19001)&quot;</span>)</span>
<span id="cb122-8"><a href="monte-carlo-simulations.html#cb122-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-9"><a href="monte-carlo-simulations.html#cb122-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(GEO_ID,state,NAME) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;MA&quot;</span>,<span class="st">&quot;M&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb122-10"><a href="monte-carlo-simulations.html#cb122-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb122-11"><a href="monte-carlo-simulations.html#cb122-11"></a>    <span class="kw">ends_with</span>(<span class="st">&quot;E&quot;</span>),</span>
<span id="cb122-12"><a href="monte-carlo-simulations.html#cb122-12"></a>    <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb122-13"><a href="monte-carlo-simulations.html#cb122-13"></a>    <span class="dt">values_to =</span> <span class="st">&quot;estimate&quot;</span></span>
<span id="cb122-14"><a href="monte-carlo-simulations.html#cb122-14"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-15"><a href="monte-carlo-simulations.html#cb122-15"></a><span class="st">  </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-16"><a href="monte-carlo-simulations.html#cb122-16"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">estimate =</span> <span class="kw">sum</span>(estimate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-17"><a href="monte-carlo-simulations.html#cb122-17"></a><span class="st">  </span><span class="kw">left_join</span>(</span>
<span id="cb122-18"><a href="monte-carlo-simulations.html#cb122-18"></a>    acs_vars_<span class="dv">2018</span>_5yr <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-19"><a href="monte-carlo-simulations.html#cb122-19"></a><span class="st">      </span><span class="kw">select</span>(name, label), </span>
<span id="cb122-20"><a href="monte-carlo-simulations.html#cb122-20"></a>    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span> =<span class="st"> &quot;name&quot;</span>)</span>
<span id="cb122-21"><a href="monte-carlo-simulations.html#cb122-21"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-22"><a href="monte-carlo-simulations.html#cb122-22"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>variable)</span>
<span id="cb122-23"><a href="monte-carlo-simulations.html#cb122-23"></a></span>
<span id="cb122-24"><a href="monte-carlo-simulations.html#cb122-24"></a>income_<span class="dv">19</span>_summary</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["estimate"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"2754402","2":"Estimate!!Total"},{"1":"91512","2":"Estimate!!Total!!Less than $10,000"},{"1":"82338","2":"Estimate!!Total!!$10,000 to $14,999"},{"1":"55815","2":"Estimate!!Total!!$15,000 to $19,999"},{"1":"61828","2":"Estimate!!Total!!$20,000 to $24,999"},{"1":"61788","2":"Estimate!!Total!!$25,000 to $29,999"},{"1":"66263","2":"Estimate!!Total!!$30,000 to $34,999"},{"1":"61623","2":"Estimate!!Total!!$35,000 to $39,999"},{"1":"66533","2":"Estimate!!Total!!$40,000 to $44,999"},{"1":"59775","2":"Estimate!!Total!!$45,000 to $49,999"},{"1":"127763","2":"Estimate!!Total!!$50,000 to $59,999"},{"1":"195713","2":"Estimate!!Total!!$60,000 to $74,999"},{"1":"297416","2":"Estimate!!Total!!$75,000 to $99,999"},{"1":"266645","2":"Estimate!!Total!!$100,000 to $124,999"},{"1":"217907","2":"Estimate!!Total!!$125,000 to $149,999"},{"1":"338795","2":"Estimate!!Total!!$150,000 to $199,999"},{"1":"702688","2":"Estimate!!Total!!$200,000 or more"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="monte-carlo-simulations.html#cb123-1"></a>income_tiers &lt;-<span class="st"> </span></span>
<span id="cb123-2"><a href="monte-carlo-simulations.html#cb123-2"></a><span class="st">  </span><span class="kw">data.frame</span>(</span>
<span id="cb123-3"><a href="monte-carlo-simulations.html#cb123-3"></a>    <span class="dt">lower_end =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">0</span>, <span class="dv">10000</span>, <span class="dv">15000</span>, <span class="dv">20000</span>, <span class="dv">25000</span>, <span class="dv">30000</span>, <span class="dv">35000</span>, <span class="dv">40000</span>, <span class="dv">45000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>, <span class="dv">75000</span>, <span class="dv">100000</span>, <span class="dv">125000</span>, <span class="dv">150000</span>, <span class="dv">200000</span>),</span>
<span id="cb123-4"><a href="monte-carlo-simulations.html#cb123-4"></a>    <span class="dt">width =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">10000</span>, <span class="kw">rep</span>(<span class="dv">5000</span>, <span class="dv">8</span>), <span class="dv">10000</span>, <span class="dv">15000</span>, <span class="kw">rep</span>(<span class="dv">25000</span>, <span class="dv">3</span>), <span class="dv">50000</span>, <span class="ot">NA</span>)</span>
<span id="cb123-5"><a href="monte-carlo-simulations.html#cb123-5"></a>  )</span>
<span id="cb123-6"><a href="monte-carlo-simulations.html#cb123-6"></a></span>
<span id="cb123-7"><a href="monte-carlo-simulations.html#cb123-7"></a>income_tiers</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lower_end"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["width"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"NA"},{"1":"0","2":"10000"},{"1":"10000","2":"5000"},{"1":"15000","2":"5000"},{"1":"20000","2":"5000"},{"1":"25000","2":"5000"},{"1":"30000","2":"5000"},{"1":"35000","2":"5000"},{"1":"40000","2":"5000"},{"1":"45000","2":"5000"},{"1":"50000","2":"10000"},{"1":"60000","2":"15000"},{"1":"75000","2":"25000"},{"1":"100000","2":"25000"},{"1":"125000","2":"25000"},{"1":"150000","2":"50000"},{"1":"200000","2":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="monte-carlo-simulations.html#cb124-1"></a>total &lt;-<span class="st"> </span>income_<span class="dv">19</span>_summary<span class="op">$</span>estimate[<span class="dv">1</span>]</span>
<span id="cb124-2"><a href="monte-carlo-simulations.html#cb124-2"></a>  </span>
<span id="cb124-3"><a href="monte-carlo-simulations.html#cb124-3"></a>row &lt;-<span class="st"> </span><span class="dv">2</span> </span>
<span id="cb124-4"><a href="monte-carlo-simulations.html#cb124-4"></a>  </span>
<span id="cb124-5"><a href="monte-carlo-simulations.html#cb124-5"></a>cumulative &lt;-<span class="st"> </span>income_<span class="dv">19</span>_summary<span class="op">$</span>estimate[row]</span>
<span id="cb124-6"><a href="monte-carlo-simulations.html#cb124-6"></a>  </span>
<span id="cb124-7"><a href="monte-carlo-simulations.html#cb124-7"></a>proportion &lt;-<span class="st"> </span>cumulative<span class="op">/</span>total</span>
<span id="cb124-8"><a href="monte-carlo-simulations.html#cb124-8"></a>  </span>
<span id="cb124-9"><a href="monte-carlo-simulations.html#cb124-9"></a><span class="cf">while</span> (proportion <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>) {</span>
<span id="cb124-10"><a href="monte-carlo-simulations.html#cb124-10"></a>    </span>
<span id="cb124-11"><a href="monte-carlo-simulations.html#cb124-11"></a>  cumulative_lag &lt;-<span class="st"> </span>cumulative</span>
<span id="cb124-12"><a href="monte-carlo-simulations.html#cb124-12"></a>  </span>
<span id="cb124-13"><a href="monte-carlo-simulations.html#cb124-13"></a>  row &lt;-<span class="st"> </span>row <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb124-14"><a href="monte-carlo-simulations.html#cb124-14"></a>  </span>
<span id="cb124-15"><a href="monte-carlo-simulations.html#cb124-15"></a>  cumulative &lt;-<span class="st"> </span>cumulative <span class="op">+</span><span class="st"> </span>income_<span class="dv">19</span>_summary<span class="op">$</span>estimate[row]</span>
<span id="cb124-16"><a href="monte-carlo-simulations.html#cb124-16"></a>  </span>
<span id="cb124-17"><a href="monte-carlo-simulations.html#cb124-17"></a>  proportion &lt;-<span class="st"> </span>cumulative<span class="op">/</span>total</span>
<span id="cb124-18"><a href="monte-carlo-simulations.html#cb124-18"></a>  </span>
<span id="cb124-19"><a href="monte-carlo-simulations.html#cb124-19"></a>}</span>
<span id="cb124-20"><a href="monte-carlo-simulations.html#cb124-20"></a>  </span>
<span id="cb124-21"><a href="monte-carlo-simulations.html#cb124-21"></a>median &lt;-<span class="st"> </span></span>
<span id="cb124-22"><a href="monte-carlo-simulations.html#cb124-22"></a><span class="st">  </span>income_tiers<span class="op">$</span>lower_end[row] <span class="op">+</span><span class="st"> </span></span>
<span id="cb124-23"><a href="monte-carlo-simulations.html#cb124-23"></a><span class="st">  </span>(total<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>cumulative_lag) <span class="op">/</span></span>
<span id="cb124-24"><a href="monte-carlo-simulations.html#cb124-24"></a><span class="st">  </span>income_<span class="dv">19</span>_summary<span class="op">$</span>estimate[row] <span class="op">*</span></span>
<span id="cb124-25"><a href="monte-carlo-simulations.html#cb124-25"></a><span class="st">  </span>income_tiers<span class="op">$</span>width[row]</span>
<span id="cb124-26"><a href="monte-carlo-simulations.html#cb124-26"></a></span>
<span id="cb124-27"><a href="monte-carlo-simulations.html#cb124-27"></a><span class="kw">prettyNum</span>(<span class="kw">round</span>(median), <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;113,954&quot;</code></pre>
<p>In the while loop above, a cumulative sum of households is aggregated income tier by income tier until the cumulative percent of households has breached 50%, meaning that the current <code>row</code> of the dataframe is the income tier that contains the median household income. From there, a linear interpolation is performed between, in this case, $100,000 and $125,000 as book-end income values and the rank order of households who are positioned at those book-end income values (in this case the 1,228,367th household and the 1,495,012th household from lowest to highest income). By assuming that each household between these households has equal increments of additional income from $100,000 to $125,000, then with some simple math we can estimate the income of the “median household”, which is the 1,377,201th household out of a total 2,754,402. The result from the above chunk is a median household income for that median household of $113,954. Notice, by the way, the use of <code>prettyNum()</code> to enable rendering of the numeric variable with a comma where we would expect it.</p>
<p>So to apply a Monte Carlo simulation, we need to functionalize what the steps we’ve just done to the single set of inputs, and then run thousands of simulations through that function. First, let’s inspect the “margins of error” that, till now, we’ve removed in our <code>getCensus()</code> pipelines. Because the American Communities Survey is answered by a sample of households in the U.S. as opposed to the full population, the Census Bureau conducts additional research and analysis to produce a measure of uncertainty associated with the sample data. The margin of error reported in the Census data is, by definition, 1.645 * standard deviation (equates to the 90% confidence band), so we can easily convert MOEs to standard deviations by dividing MOEs by 1.645. First we need to produce the MOEs for each aggregated Bay Area income tier, just like we produced the mean household counts for each aggregated Bay Area income tier previously. Instead of summing, we take the square root of the sum of squares when adding margins of error together, as per <a href="https://www.census.gov/content/dam/Census/library/publications/2018/acs/acs_general_handbook_2018.pdf">Ch. 8 of the ACS Handbook</a>.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="monte-carlo-simulations.html#cb126-1"></a>income_<span class="dv">19</span>_summary_moe &lt;-<span class="st"> </span></span>
<span id="cb126-2"><a href="monte-carlo-simulations.html#cb126-2"></a><span class="st">  </span><span class="kw">getCensus</span>(</span>
<span id="cb126-3"><a href="monte-carlo-simulations.html#cb126-3"></a>    <span class="dt">name =</span> <span class="st">&quot;acs/acs1&quot;</span>,</span>
<span id="cb126-4"><a href="monte-carlo-simulations.html#cb126-4"></a>    <span class="dt">vintage =</span> <span class="dv">2019</span>,</span>
<span id="cb126-5"><a href="monte-carlo-simulations.html#cb126-5"></a>    <span class="dt">region =</span> <span class="st">&quot;county:001,013,041,055,075,081,085,095,097&quot;</span>,</span>
<span id="cb126-6"><a href="monte-carlo-simulations.html#cb126-6"></a>    <span class="dt">regionin =</span> <span class="st">&quot;state:06&quot;</span>,</span>
<span id="cb126-7"><a href="monte-carlo-simulations.html#cb126-7"></a>    <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">&quot;group(B19001)&quot;</span>)</span>
<span id="cb126-8"><a href="monte-carlo-simulations.html#cb126-8"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb126-9"><a href="monte-carlo-simulations.html#cb126-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">!</span><span class="kw">c</span>(GEO_ID,state,NAME) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;MA&quot;</span>,<span class="st">&quot;E&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb126-10"><a href="monte-carlo-simulations.html#cb126-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(</span>
<span id="cb126-11"><a href="monte-carlo-simulations.html#cb126-11"></a>    <span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;M&quot;</span>)),</span>
<span id="cb126-12"><a href="monte-carlo-simulations.html#cb126-12"></a>    <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb126-13"><a href="monte-carlo-simulations.html#cb126-13"></a>    <span class="dt">values_to =</span> <span class="st">&quot;estimate&quot;</span></span>
<span id="cb126-14"><a href="monte-carlo-simulations.html#cb126-14"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb126-15"><a href="monte-carlo-simulations.html#cb126-15"></a><span class="st">  </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb126-16"><a href="monte-carlo-simulations.html#cb126-16"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">estimate =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(estimate<span class="op">^</span><span class="dv">2</span>)))</span>
<span id="cb126-17"><a href="monte-carlo-simulations.html#cb126-17"></a></span>
<span id="cb126-18"><a href="monte-carlo-simulations.html#cb126-18"></a>income_<span class="dv">19</span>_summary_moe</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["variable"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"B19001_001M","2":"9277.997"},{"1":"B19001_002M","2":"5143.526"},{"1":"B19001_003M","2":"5555.183"},{"1":"B19001_004M","2":"4307.031"},{"1":"B19001_005M","2":"4306.273"},{"1":"B19001_006M","2":"4597.007"},{"1":"B19001_007M","2":"4637.120"},{"1":"B19001_008M","2":"4272.855"},{"1":"B19001_009M","2":"4519.033"},{"1":"B19001_010M","2":"4125.256"},{"1":"B19001_011M","2":"6194.473"},{"1":"B19001_012M","2":"7836.480"},{"1":"B19001_013M","2":"8678.040"},{"1":"B19001_014M","2":"8322.292"},{"1":"B19001_015M","2":"7611.756"},{"1":"B19001_016M","2":"8922.061"},{"1":"B19001_017M","2":"10901.286"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>At this point, <code>income_19_summary</code> contains all the mean inputs that are necessary to calculate the median household income, as done previously, while <code>income_19_summary_moe</code> contains the margins of error of each of these inputs. The next step is to generate many copies of <code>income_19_summary</code>, but with the potential for each individual value to vary based on a normal distribution. We’ve used one of the mapping functions before from the <code>purrr</code> package within <code>tidyverse</code>, <code>map_dfr()</code>, which functions like a for loop and conveniently <code>rbind()</code>s the results together into a dataframe. <code>map()</code> would perform the same looping function but provide the output as a list of elements (this, for example, may be a more convenient format to pipe directly into another <code>map()</code>, since the input format should be a list; remember that a list is basically a class-agnostic combination of objects). In this case, we want to pass two different lists of inputs into the mapping function, so we use <code>map2()</code>:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="monte-carlo-simulations.html#cb127-1"></a>income_<span class="dv">19</span>_summary_montecarlo &lt;-</span>
<span id="cb127-2"><a href="monte-carlo-simulations.html#cb127-2"></a><span class="st">  </span><span class="kw">map2</span>(</span>
<span id="cb127-3"><a href="monte-carlo-simulations.html#cb127-3"></a>    income_<span class="dv">19</span>_summary<span class="op">$</span>estimate,</span>
<span id="cb127-4"><a href="monte-carlo-simulations.html#cb127-4"></a>    income_<span class="dv">19</span>_summary_moe<span class="op">$</span>estimate<span class="op">/</span><span class="fl">1.645</span>,</span>
<span id="cb127-5"><a href="monte-carlo-simulations.html#cb127-5"></a>    <span class="cf">function</span>(x,y) <span class="kw">rnorm</span>(<span class="dv">10000</span>, x, y)</span>
<span id="cb127-6"><a href="monte-carlo-simulations.html#cb127-6"></a>  )</span></code></pre></div>
<p>Use <code>View(income_19_summary_montecarlo)</code> in your Console to inspect the structure of this output, which will look like an object that contains 17 double-bracket items within it, and each of those items is a vector of 10,000 numbers. Actually, we’d prefer to have the transposed version of this data, with 10,000 list items, each with a vector of 17 numbers, as that would better match our notion of 10,000 simulations of the 17 income tier household counts. <code>transpose()</code> from <code>purrr</code> is designed to do this to map outputs:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="monte-carlo-simulations.html#cb128-1"></a>income_<span class="dv">19</span>_summary_montecarlo &lt;-</span>
<span id="cb128-2"><a href="monte-carlo-simulations.html#cb128-2"></a><span class="st"> </span>income_<span class="dv">19</span>_summary_montecarlo <span class="op">%&gt;%</span></span>
<span id="cb128-3"><a href="monte-carlo-simulations.html#cb128-3"></a><span class="st"> </span><span class="kw">transpose</span>()</span></code></pre></div>
<p>Use <code>View(income_19_summary_montecarlo)</code> again in your Console to see how the data structure has changed. Now, we can pass this directly into a <code>map()</code>, in which our mapping function takes an individual simulation (hold in the dummy variable <code>income</code>), <code>unlist()</code>s into a vector the contents of this object, which itself was a list of the 17 variables as a result of <code>transpose()</code>, and then performs a median household income calculation in exactly the same way as we did before (with just cosmetic changes given the different data structure). Note that if the function within <code>map()</code> has multiple steps, it will assume that the final data object created, in this case <code>median</code>, is the “output” desired; if not, you would use <code>return()</code> to specify the desired output. Also note the use of <code>unlist()</code> one last time at the end of the pipeline, so that the list of 10,000 simulation outputs is turned into a vector of numbers that can be plotted using <code>hist()</code>.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="monte-carlo-simulations.html#cb129-1"></a>montecarlo_result &lt;-</span>
<span id="cb129-2"><a href="monte-carlo-simulations.html#cb129-2"></a><span class="st">  </span>income_<span class="dv">19</span>_summary_montecarlo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-3"><a href="monte-carlo-simulations.html#cb129-3"></a><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(income){</span>
<span id="cb129-4"><a href="monte-carlo-simulations.html#cb129-4"></a>    </span>
<span id="cb129-5"><a href="monte-carlo-simulations.html#cb129-5"></a>    income &lt;-<span class="st"> </span>income <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</span>
<span id="cb129-6"><a href="monte-carlo-simulations.html#cb129-6"></a>    total &lt;-<span class="st"> </span>income[<span class="dv">1</span>]</span>
<span id="cb129-7"><a href="monte-carlo-simulations.html#cb129-7"></a>    row &lt;-<span class="st"> </span><span class="dv">2</span> </span>
<span id="cb129-8"><a href="monte-carlo-simulations.html#cb129-8"></a>    cumulative &lt;-<span class="st"> </span>income[row]</span>
<span id="cb129-9"><a href="monte-carlo-simulations.html#cb129-9"></a>    proportion &lt;-<span class="st"> </span>cumulative<span class="op">/</span>total</span>
<span id="cb129-10"><a href="monte-carlo-simulations.html#cb129-10"></a>      </span>
<span id="cb129-11"><a href="monte-carlo-simulations.html#cb129-11"></a>    <span class="cf">while</span> (proportion <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>) {</span>
<span id="cb129-12"><a href="monte-carlo-simulations.html#cb129-12"></a>      cumulative_lag &lt;-<span class="st"> </span>cumulative</span>
<span id="cb129-13"><a href="monte-carlo-simulations.html#cb129-13"></a>      row &lt;-<span class="st"> </span>row <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb129-14"><a href="monte-carlo-simulations.html#cb129-14"></a>      cumulative &lt;-<span class="st"> </span>cumulative <span class="op">+</span><span class="st"> </span>income[row]</span>
<span id="cb129-15"><a href="monte-carlo-simulations.html#cb129-15"></a>      proportion &lt;-<span class="st"> </span>cumulative<span class="op">/</span>total</span>
<span id="cb129-16"><a href="monte-carlo-simulations.html#cb129-16"></a>    }</span>
<span id="cb129-17"><a href="monte-carlo-simulations.html#cb129-17"></a>      </span>
<span id="cb129-18"><a href="monte-carlo-simulations.html#cb129-18"></a>    median &lt;-<span class="st"> </span></span>
<span id="cb129-19"><a href="monte-carlo-simulations.html#cb129-19"></a><span class="st">      </span>income_tiers<span class="op">$</span>lower_end[row] <span class="op">+</span><span class="st"> </span></span>
<span id="cb129-20"><a href="monte-carlo-simulations.html#cb129-20"></a><span class="st">      </span>(total<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>cumulative_lag) <span class="op">/</span></span>
<span id="cb129-21"><a href="monte-carlo-simulations.html#cb129-21"></a><span class="st">      </span>income[row] <span class="op">*</span></span>
<span id="cb129-22"><a href="monte-carlo-simulations.html#cb129-22"></a><span class="st">      </span>income_tiers<span class="op">$</span>width[row]</span>
<span id="cb129-23"><a href="monte-carlo-simulations.html#cb129-23"></a>    </span>
<span id="cb129-24"><a href="monte-carlo-simulations.html#cb129-24"></a>  }) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-25"><a href="monte-carlo-simulations.html#cb129-25"></a><span class="st">  </span><span class="kw">unlist</span>()</span>
<span id="cb129-26"><a href="monte-carlo-simulations.html#cb129-26"></a></span>
<span id="cb129-27"><a href="monte-carlo-simulations.html#cb129-27"></a><span class="kw">hist</span>(montecarlo_result)</span></code></pre></div>
<p><img src="course_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<p>We can do statistical measures on this vector of 10,000 numbers, as desired.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="monte-carlo-simulations.html#cb130-1"></a><span class="kw">mean</span>(montecarlo_result)</span></code></pre></div>
<pre><code>## [1] 113960.5</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="monte-carlo-simulations.html#cb132-1"></a><span class="kw">sd</span>(montecarlo_result)<span class="op">*</span><span class="fl">1.645</span></span></code></pre></div>
<pre><code>## [1] 1914.16</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="monte-carlo-simulations.html#cb134-1"></a>upper &lt;-<span class="st"> </span><span class="kw">mean</span>(montecarlo_result) <span class="op">+</span><span class="st"> </span><span class="fl">1.645</span><span class="op">*</span><span class="kw">sd</span>(montecarlo_result)</span>
<span id="cb134-2"><a href="monte-carlo-simulations.html#cb134-2"></a>lower &lt;-<span class="st"> </span><span class="kw">mean</span>(montecarlo_result) <span class="op">-</span><span class="st"> </span><span class="fl">1.645</span><span class="op">*</span><span class="kw">sd</span>(montecarlo_result)</span>
<span id="cb134-3"><a href="monte-carlo-simulations.html#cb134-3"></a></span>
<span id="cb134-4"><a href="monte-carlo-simulations.html#cb134-4"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-5"><a href="monte-carlo-simulations.html#cb134-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(</span>
<span id="cb134-6"><a href="monte-carlo-simulations.html#cb134-6"></a>    <span class="kw">aes</span>(montecarlo_result)</span>
<span id="cb134-7"><a href="monte-carlo-simulations.html#cb134-7"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-8"><a href="monte-carlo-simulations.html#cb134-8"></a><span class="st">  </span><span class="kw">geom_vline</span>(</span>
<span id="cb134-9"><a href="monte-carlo-simulations.html#cb134-9"></a>    <span class="kw">aes</span>(</span>
<span id="cb134-10"><a href="monte-carlo-simulations.html#cb134-10"></a>      <span class="dt">xintercept =</span> <span class="kw">mean</span>(montecarlo_result)</span>
<span id="cb134-11"><a href="monte-carlo-simulations.html#cb134-11"></a>    ), </span>
<span id="cb134-12"><a href="monte-carlo-simulations.html#cb134-12"></a>    <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb134-13"><a href="monte-carlo-simulations.html#cb134-13"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-14"><a href="monte-carlo-simulations.html#cb134-14"></a><span class="st">  </span><span class="kw">geom_vline</span>(</span>
<span id="cb134-15"><a href="monte-carlo-simulations.html#cb134-15"></a>    <span class="kw">aes</span>(</span>
<span id="cb134-16"><a href="monte-carlo-simulations.html#cb134-16"></a>      <span class="dt">xintercept =</span> lower</span>
<span id="cb134-17"><a href="monte-carlo-simulations.html#cb134-17"></a>    ), </span>
<span id="cb134-18"><a href="monte-carlo-simulations.html#cb134-18"></a>    <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb134-19"><a href="monte-carlo-simulations.html#cb134-19"></a>  ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-20"><a href="monte-carlo-simulations.html#cb134-20"></a><span class="st">  </span><span class="kw">geom_vline</span>(</span>
<span id="cb134-21"><a href="monte-carlo-simulations.html#cb134-21"></a>    <span class="kw">aes</span>(</span>
<span id="cb134-22"><a href="monte-carlo-simulations.html#cb134-22"></a>      <span class="dt">xintercept =</span> upper</span>
<span id="cb134-23"><a href="monte-carlo-simulations.html#cb134-23"></a>    ), </span>
<span id="cb134-24"><a href="monte-carlo-simulations.html#cb134-24"></a>    <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb134-25"><a href="monte-carlo-simulations.html#cb134-25"></a>  ) <span class="op">+</span></span>
<span id="cb134-26"><a href="monte-carlo-simulations.html#cb134-26"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb134-27"><a href="monte-carlo-simulations.html#cb134-27"></a>    <span class="dt">x =</span> <span class="st">&quot;Median Household Income ($)&quot;</span>,</span>
<span id="cb134-28"><a href="monte-carlo-simulations.html#cb134-28"></a>    <span class="dt">y =</span> <span class="st">&quot;# of Simulations&quot;</span>,</span>
<span id="cb134-29"><a href="monte-carlo-simulations.html#cb134-29"></a>    <span class="dt">title =</span> <span class="st">&quot;Monte Carlo simulation, Bay Area households&quot;</span></span>
<span id="cb134-30"><a href="monte-carlo-simulations.html#cb134-30"></a>  )</span></code></pre></div>
<p><img src="course_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<p>The “MOE” derived through this Monte Carlo method should be similar to the MOE you could compute using formal mathematical functions, but now this R technique can be used, and generally can get you faster results than “working out the math”, and is especially handy for complex, nonlinear analyses where “working out the math” would be impossible.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="probability-distributions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="simple-linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": false,
"info": false
});
});
</script>

</body>

</html>
